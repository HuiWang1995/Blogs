# 统一监控平台概要设计

## 整体思路

1. 前后端分离

   前端进行监控结果展示、监视器配置、告警配置等。

2. 后端由功能分为：

   1. 监控数据展示服务

      从监控数据库中查询数据，对外提供查询服务。

   2. 告警分发服务

      从监控数据库中根据配置判断是否生成告警，并分发出去。

   3. 监控数据采集服务

      根据监视器配置进行具体监控数据采集并入库。

   4. 监视器配置服务

      后管服务，用于提供管理台配置监视器、告警规则。可以与监控展示服务合一提供前端服务。以及后期接入Jenkins之类的DevOps时，提供监视器的自动录入。

   5. 监视器调度服务（后期）

      本质上，监控数据采集服务为定时任务，且其最需要进行保活。所以往往其会进行集群部署，当其有节点发生下线时，其分配的监视数据采集任务应当由调度服务分配给其他节点进行采集。

   6. 数据格式转换层（后期）

      数据接入接出的格式转换，便于接入已有生态圈。

3. 监控数据采集服务可插件化（后期）

   参考skywalking，核心流程不受影响的情况下，可以定制jar包插件来丰富采集数据的多样性。

4. 提供SDK（后期）

   可以由SDK进行自动收集Prometheus、Actuator数据。同样提供SDK扩展接口，可以由业务系统自定义发送规范的监控指标数据。

## 技术选型

### 前端

基于[vue-element-admin](https://github.com/PanJiaChen/vue-element-admin)进行二次开发，该管理台社区活跃度高，使用众多。

### 后端

- 框架

  Spring Boot

- SSH连接

  ganymed-ssh2。比较ganymed-ssh2与jsch时，网上更多的呼声，以及在文档上的支持都是ganymed-ssh2更高一点。以及曾在使用jsch时，发现其已经数年未更新，在SSH版本较高时，将无法解析密钥对的新版协议。故选择ganymed-ssh2进行JAVA端连接操作Linux。

- 通讯协议

  http
  
### 代理端

代理端初版暂无计划，应优先JAVA编写代理端。  


### 数据库

- 应用数据库Mysql

  在常见的数据库中，ORACLE、PG、DB2、MySQL中，优先选择既有开源免费版，也有提供商业服务的MySQL，后续会优先考虑兼容ORACLE。

- 时序数据库InfluxDB

  在存储监控数据时，优先选择业界主流InfluxDB，其在性能以及数据压缩率上都是十分强大的。

  |                    | Timescale | InfluxDB | OpenTSDB | Druid    | Elasticsearch | Beringei |
  | ------------------ | --------- | -------- | -------- | -------- | ------------- | -------- |
  | write(single node) | 15K/sec   | 470k/sec | 32k/sec  | 25k/sec  | 30k/sec       | 10m/sec  |
  | write(5 node)      |           |          | 128k/sec | 100k/sec | 120k/sec      |          |

*这两种数据库选型对于开源使用、快速搭建环境是一个十分好的选择。以及个人对这两种熟悉度尚可。*



## 初期计划

​		初期重要在完成基础的后端核心服务设计实现，提供基础监控、告警。

​		前端优先完成监视器的配置页面，展示页面可以先外接在grafana上。

## 中期计划

​		中期实现未标注“后期”的功能模块。已经能完成大量监控，且具有扩展能力。

## 后期计划

​		实现后期计划的所有功能，达成可企业级使用。以及考虑接入单点登录、权限控制，例如多部门环境隔离、多法人等等。

​	