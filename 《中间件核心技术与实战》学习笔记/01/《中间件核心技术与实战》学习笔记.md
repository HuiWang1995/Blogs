# 《中间件核心技术与实战》学习笔记
近日，花了大约两到三天的业余时间，粗略的阅读了《中间件核心技术与实战》。
这是一篇概念+实战的干货专栏，出现了许多RocketMQ、Netty的源码。以及各类中间件在中通快递的应用、实战。
本次阅读的目的为了解中间件开发时的架构选择、设计理念、核心技术、生产运维、故障排查。
下图是个人简略后专栏的大纲
![《中间件核心技术与实战》学习总结.jpeg](img.jpeg)

## 认知
中间件是从业务系统中抽象、解耦出来的技术组件。追求“三高”(高可用、高性能、高并发)，由专业的团队进行维护。
便于各个业务应用系统更稳定、简易的实现复杂的场景。

专栏中，列举了一些分布式应用体系常用的中间件。
![img.png](img.png)

那么，有这么多中间件，我们如何选择其作为我们的解决方案中的组件。
1. 首先梳理清楚业务需求，需要用到中间件的什么能力。尽可能选择覆盖更广的中间件。
2. 其次，对性能问题需要有长远的考虑。性能问题都具有隐蔽性，一旦发生，破坏性大，影响程度深。
任何涉及到功能的短板，都可以通过其他方式实现。
3. 技术栈符合度。最主要的就是编程语言，语言不被团队掌握，对中间件掌控能力弱，难以保证生产稳定运行。
甚至面对问题，难以下手解决。

## 基础
与业务系统不同，中间件对数据结构、并发编程、锁、网络IO等基础知识要求严苛的多。
例如内存数据库Redis对内存的管理、关系型数据库对数据文件在磁盘上的存储管理、
Web容器对于网络IO的处理、Zookeeper对分布式协议的实现。

专栏中，有对红黑树、AQS框架的源码详细解读，值得一读。

## 微服务
对Dubbo与Spring cloud 进行了对比。
- Dubbo继承度更高，性能更高
- Spring cloud 功能更丰富

在我看来，两者是可以共存的，在企业级的实践中，也的确有公司基于spring cloud框架使用兼容性更高的协议，
打造兼容多rpc协议的微服务调用框架。将dubbo、spring cloud、sofa等调用兼容。
对于相同协议的框架，调用性能会更高，但也不至于系统移植时改造成本过高。

### 网关
在网关的设计案例中，提及了以下关注点：
- 安全
能够对请求进行 验证签名。对于需要进行互联网传输的请求，安全性是十分重要的。
- 适配
能够对json、xml等报文进行适配、转换。即使当前json盛行，但是xml仍然存在，且不可轻动。
- 配置化
对参数进行配置、映射。
- 限流
限流是应该高并发时，保护服务可用的重要手段。

另外，熔断、接口授权等功能可能也是需要的。

### 蓝绿发布
类似于灰度发布，也是分批次，使得生产上出现两个版本的应用。
不过灰度发布，是不使用实际用户流量进行测试，而是让技术人员进行测试，通过后才正式发布。
而蓝绿发布则是使用实际用户流量进行测试，若发生问题，则将流量切换到旧版本中，并快速回滚。

其实现的原理，是在服务的入口中对请求进行“染色”，进行流量切分、路由。
但是要注意到兼容未实现蓝绿发布的系统。